<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iggle â€” Play Epic Games</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
  body { display: flex; height: 100vh; overflow: hidden; background: #f6fbff; color: #072a46; }
  #sidebar { width: 300px; background: #fff; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; overflow-y: auto; }
  #sidebar h2 { font-size: 14px; padding: 10px 16px; color: #1877f2; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 8px; border-top: 1px solid #eee; }
  #gamesList, .sectionList { flex: 1; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
  .class { display: flex; align-items: center; padding: 8px; gap: 8px; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
  .class:hover { background: #f0f4ff; }
  .class.active { background: #e6f0ff; border-left: 4px solid #1877f2; }
  .thumb { width: 36px; height: 36px; background: #1877f2; color: #fff; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 600; }
  .meta { flex: 1; display: flex; flex-direction: column; }
  .title { font-weight: 600; font-size: 14px; }
  .sub { font-size: 12px; color: #555; }
  .play-btn { padding: 4px 8px; background: #1877f2; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
  #main { flex: 1; display: flex; flex-direction: column; }
  #playerBar { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; background: #fff; border-bottom: 1px solid #e0e0e0; }
  #playerInfo { display: flex; flex-direction: column; }
  #playerTitle { font-weight: 600; font-size: 16px; }
  #playerSub { font-size: 13px; color: #555; }
  #controls { display: flex; gap: 8px; }
  #controls button { padding: 6px 12px; background: #1877f2; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
  #frameWrap { flex: 1; position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
  #gameFrame { width: 100%; height: 100%; border: none; display: none; }
  #placeholder { position: absolute; display: grid; place-items: center; color: #fff; font-size: 18px; background: rgba(0,0,0,0.5); width: 100%; height: 100%; }
  #weeklyDrop { padding: 12px; background: #fff; border-top: 1px solid #e0e0e0; }
  #weeklyDrop h3 { color: #1877f2; font-size: 14px; margin-bottom: 8px; }
  iframe.weekly-frame { width: 100%; border-radius: 10px; border: none; height: 320px; }
</style>
</head>
<body>

<div id="sidebar">
  <h2>New Games</h2>
  <div id="gamesList"></div>

  <h2>ðŸŽƒ Halloween Drop</h2>
  <div class="sectionList" id="halloweenList"></div>

  <div id="weeklyDrop">
    <h3>ðŸŒŸ Weekly Game Drop</h3>
    <iframe data-testid="gabe-frabe" id="gabe-frabe" class="weekly-frame"
      allowfullscreen="" allow="autoplay; fullscreen; camera; focus-without-user-activation *; monetization; gamepad; keyboard-map *; xr-spatial-tracking; clipboard-write"
      name="appFrame" scrolling="no" sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock
        allow-popups allow-popups-to-escape-sandbox allow-presentation allow-scripts allow-same-origin
        allow-downloads"
      src="https://db.quackprep.org/html/animal_crossing/index.html"></iframe>
  </div>
</div>

<div id="main">
  <div id="playerBar">
    <div id="playerInfo">
      <div id="playerTitle">Select a Game</div>
      <div id="playerSub"></div>
    </div>
    <div id="controls">
      <button id="fullBtn">Fullscreen</button>
      <button id="openNewBtn">Open in New Tab</button>
      <button id="reloadBtn">Reload</button>
    </div>
  </div>
  <div id="frameWrap">
    <iframe id="gameFrame"></iframe>
    <div id="placeholder">Loading...</div>
  </div>
</div>

<script>
const games = [
  {id:'clash-royale', title:'Clash Royale', subtitle:'Official remake', src:'https://db.quackprep.org/html/clash_royale/index.html'},
  {id:'hollow-knight', title:'Hollow Knight', subtitle:'A platformer', src:'https://db.quackprep.org/html/hollow_knight/index.html'},
  {id:'steal-brainrot', title:'Steal a Brainrot', subtitle:'(steal a brainrot)', src:'https://db.quackprep.org/html/steal_a_brainrot/index.html'},
  {id:'worlds-hardest', title:"The World's Hardest Game", subtitle:'Try not to rage', src:'https://db.quackprep.org/html/theworldshardestgame/index.html'},
  {id:'twerk-race', title:'Twerk Race 3D', subtitle:'Race-y runner', src:'https://db.quackprep.org/html/twerk_race_3d/index.html'},
  {id:'street-fighter', title:'Street Fighter', subtitle:'Retro fighting â€” Game of the Week', src:'https://db.quackprep.org/html/street_fighter/index.html', featured:true},
  {id:'temple-run', title:'Temple Run 2', subtitle:'Endless runner', src:'https://db.quackprep.org/html/temple_run_2/index.html'},
  {id:'rocket-league', title:'Rocket League (Derby)', subtitle:'Car football', src:'https://db.quackprep.org/html/rocket_soccer_derby/index.html'},
  {id:'thorns-balloons', title:'Thorns & Balloons', subtitle:'Pop', src:'https://db.quackprep.org/html/thorns_and_ballons/index.html'},
  {id:'doom-1', title:'DOOM 1 (remake)', subtitle:'Classic shooter', src:'https://db.quackprep.org/html/doom_1/index.html'},
  {id:'forest-99', title:'Budget 99 Nights in the Forest', subtitle:'Explore the wild', src:'https://db.quackprep.org/html/99_nights_in_the_forest/index.html'},
  {id:'eagler-craft', title:'Eagler Craft', subtitle:'Minecraft-style sandbox', src:'https://db.quackprep.org/html/minecraft/index.html'},
  {id:'bloons-td', title:'Bloons TD', subtitle:'Pop the waves', src:'https://db.quackprep.org/html/bloons_td/index.html'},
  {id:'snow-rider', title:'Snow Rider 3D', subtitle:'Winter downhill run', src:'https://db.quackprep.org/html/snow_rider_3d/index.html'}
];

const halloweenGames = [
  {id:'forest-99', title:'Budget 99 Nights in the Forest', subtitle:'Explore the wild (Halloween drop)', src:'https://db.quackprep.org/html/99_nights_in_the_forest/index.html'}
];

const gamesList = document.getElementById('gamesList');
const halloweenList = document.getElementById('halloweenList');
const frame = document.getElementById('gameFrame');
const placeholder = document.getElementById('placeholder');
const playerTitle = document.getElementById('playerTitle');
const playerSub = document.getElementById('playerSub');
const fullBtn = document.getElementById('fullBtn');
const openNewBtn = document.getElementById('openNewBtn');
const reloadBtn = document.getElementById('reloadBtn');
const frameWrap = document.getElementById('frameWrap');
let activeId = null;

function makeGameItem(game) {
  const el = document.createElement('div');
  el.className = 'class';
  el.dataset.id = game.id;
  el.innerHTML = `
    <div class="thumb">${game.title.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
    <div class="meta">
      <div class="title">${game.title}</div>
      <div class="sub">${game.subtitle}</div>
    </div>
    <div><button class="play-btn">Play</button></div>
  `;
  el.querySelector('.play-btn').addEventListener('click', e => { e.stopPropagation(); loadGame(game); });
  el.addEventListener('click', () => loadGame(game));
  return el;
}

games.forEach(game => {
  const item = makeGameItem(game);
  if(game.featured) item.style.border = '2px solid rgba(24,119,242,0.3)';
  gamesList.appendChild(item);
});

halloweenGames.forEach(game => {
  halloweenList.appendChild(makeGameItem(game));
});

async function loadGame(game) {
  if(activeId === game.id) return;

  const prev = document.querySelector('.class.active');
  if(prev) prev.classList.remove('active');

  placeholder.style.display = 'grid';
  frame.style.display = 'none';
  frame.src = '';

  await new Promise(r => setTimeout(r, 80));

  frame.src = game.src;
  frame.style.display = 'block';
  placeholder.style.display = 'none';

  activeId = game.id;
  playerTitle.textContent = game.title + (game.featured ? ' â€” Game of the Week' : '');
  playerSub.textContent = game.subtitle;

  const el = document.querySelector(`[data-id="${game.id}"]`);
  if(el) el.classList.add('active');

  frame.onload = () => { try { frame.contentWindow.focus(); } catch(e) {} };
}

fullBtn.addEventListener('click', async () => {
  try {
    if(document.fullscreenElement) await document.exitFullscreen();
    else await frameWrap.requestFullscreen();
  } catch(e){}
});

openNewBtn.addEventListener('click', () => {
  if(!activeId) return alert('Select a game first');
  const game = games.find(g => g.id === activeId) || halloweenGames.find(g => g.id === activeId);
  if(!game) return;
  const win = window.open('', '_blank');
  if(!win) return alert('Popup blocked â€” allow popups for this site');

  const html = `<!doctype html><html><head><meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Iggle â€” ${game.title}</title>
  <style>
    body{margin:0;font-family:Inter,system-ui,Arial;background:#f6fbff;color:#072a46}
    header{padding:12px 16px;background:linear-gradient(90deg,#1877f2 0%,#0b61d8 100%);color:#fff;display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:16px}
    iframe{width:100%;height:100vh;border:0}
    button{background:#fff;color:#1877f2;border:none;padding:6px 12px;border-radius:6px;font-weight:600;cursor:pointer;}
  </style>
  </head><body>
  <header>
    <div style="display:flex;align-items:center;gap:10px;">
      <button onclick="history.back()">â¬… Back</button>
      <h1>Iggle â€” ${game.title}</h1>
    </div>
  </header>
  <iframe src="${game.src}" allowfullscreen allow="autoplay; fullscreen; camera; gamepad; clipboard-write"
  sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-scripts allow-same-origin allow-downloads"></iframe>
  </body></html>`;

  win.document.open(); win.document.write(html); win.document.close();
});

reloadBtn.addEventListener('click', () => {
  if(!activeId) return alert('Select a game first');
  const game = games.find(g => g.id === activeId) || halloweenGames.find(g => g.id === activeId);
  if(!game) return;
  frame.src = '';
  setTimeout(() => frame.src = game.src, 60);
});

window.addEventListener('keydown', e => {
  if(e.key === 'f') { e.preventDefault(); fullBtn.click(); }
});

const featured = games.find(g => g.featured);
if(featured) setTimeout(() => loadGame(featured), 250);
</script>

</body>
</html>
